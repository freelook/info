"use strict";angular.module("freelook.info",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngRoute","ngMaterial","fli.home","fli.menu","fli.search","fli.look"]).config(["$locationProvider","$httpProvider","$routeProvider","$mdThemingProvider",function(e,t,n,o){e.html5Mode(!0),e.hashPrefix("!"),t.defaults.cache=!0,t.interceptors.push("LoaderInterceptor"),o.theme("default").accentPalette("deep-purple"),n.otherwise({redirectTo:"/"})}]).run(function(){}),angular.module("freelook.info").controller("index.ctrl",["$rootScope","$route","$location","DEFAULT_TITLE","DEFAULT_DESCRIPTION",function(e,t,n,o,r){e.fli={},e.fli.title=o,e.fli.description=r,e.go=function(e){if(e)switch(typeof e){case"string":n.url(e);break;case"object":t.updateParams(e)}}}]).constant("DEFAULT_TITLE","FLI - free look at info").constant("DEFAULT_DESCRIPTION","Your personal information manager. Just look what you need."),angular.module("fli.home",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngRoute","ngMaterial"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"components/home/home.html",controller:"home.ctrl"})}]),angular.module("fli.home").controller("home.ctrl",["$rootScope","$routeParams","$scope","$mdMedia","DEFAULT_TITLE","DEFAULT_DESCRIPTION","local","SEARCH_KEY","LOOK_KEY",function(e,t,n,o,r,i,l,u,a){e.fli.route=t||{},e.fli.media=o,e.fli.title=e.fli.route.input?"FLI - "+e.fli.route.input:r,e.fli.description=i,n.searchs=l.get(u),n.looks=l.get(a),n.widgets=[{name:"Search",items:n.searchs,href:function(e){return"search?input="+e.input}},{name:"Look",items:n.looks,href:function(e){return"look?input="+e.input+"&url="+e.url}},{name:"Social"}]}]),angular.module("fli.look",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngRoute","ngMaterial"]).config(["$routeProvider",function(e){e.when("/look",{templateUrl:"components/look/look.html",controller:"look.ctrl"})}]).constant("LOOK_KEY","LOCAL:LOOK"),angular.module("fli.look").controller("look.ctrl",["$rootScope","$routeParams","$location","$mdMedia","DEFAULT_TITLE","DEFAULT_DESCRIPTION","local","LOOK_KEY",function(e,t,n,o,r,i,l,u){n.search({url:t.url,input:t.input}),e.fli.route=t||{},e.fli.media=o,e.fli.title=e.fli.route.input?"FLI - "+e.fli.route.input:r,e.fli.description=i,e.fli.route.input&&e.fli.route.url&&l.push(u,{input:e.fli.route.input,url:e.fli.route.url},10)}]),angular.module("fli.menu",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngRoute","ngMaterial"]).config(["$routeProvider",function(e){e.when("/menu",{templateUrl:"components/menu/menu.html",controller:"menu.ctrl"})}]),angular.module("fli.menu").controller("menu.ctrl",["$rootScope","$routeParams","$scope","$mdMedia","DEFAULT_TITLE","DEFAULT_DESCRIPTION",function(e,t,n,o,r,i){e.fli.route=t||{},e.fli.media=o,e.fli.title=e.fli.route.input?"FLI - "+e.fli.route.input:r,e.fli.description=i,n.menu=[{name:"Home",icon:"home",href:"/"},{name:"Search",icon:"search",href:"/search"},{name:"Add",icon:"plus"}]}]),angular.module("fli.search",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngRoute","ngMaterial"]).config(["$routeProvider",function(e){e.when("/search",{templateUrl:"components/search/search.html",controller:"search.ctrl"})}]).constant("SEARCH_KEY","LOCAL:SEARCH"),angular.module("freelook.info").controller("search.ctrl",["$rootScope","$routeParams","$location","$mdMedia","DEFAULT_TITLE","DEFAULT_DESCRIPTION","local","SEARCH_KEY",function(e,t,n,o,r,i,l,u){n.search({input:t.input||"",url:t.url||""}),e.fli.route=t||{},e.fli.media=o,e.fli.title=e.fli.route.input?"FLI - "+e.fli.route.input:r,e.fli.description=e.fli.route.input?"FLI - free look at "+e.fli.route.input:i,e.fli.route.input&&l.push(u,{input:e.fli.route.input},10)}]),angular.module("freelook.info").factory("api",["$q","$http","$window","toast",function(e,t,n,o){function r(r){if(r){var i=e.defer(),l=n.CONFIG.API.URL+"/get?url="+encodeURIComponent(r)+"&callback=JSON_CALLBACK";return t.jsonp(l).success(function(e){e.Error?i.reject(e):i.resolve(e)}).error(function(e){o.show("something went wrong"),i.reject(e)}),i.promise}}return{get:r}}]),angular.module("freelook.info").factory("io",["$rootScope","$window",function(e,t){var n=t.io&&t.io.connect(t.CONFIG.API.URL);return{on:function(t,o){return n&&n.on(t,function(){var t=arguments;e.$apply(function(){o.apply(n,t)})})},emit:function(t,o,r){return n&&n.emit(t,o,function(){var t=arguments;e.$apply(function(){r&&r.apply(n,t)})})}}}]),angular.module("freelook.info").factory("LoaderInterceptor",["$q","$rootScope",function(e,t){function n(){return r>0}function o(e){t.fli.progress=e}var r=0;return{request:function(t){return r++,o(n()),t||e.when(t)},response:function(t){return--r,o(n()),t||e.when(t)},responseError:function(t){return--r,o(n()),e.reject(t)}}}]),angular.module("freelook.info").factory("local",["$window",function(e){function t(t,n){var o=e.JSON.parse(e.localStorage.getItem(t));return o?o:n||""}function n(t,n){try{e.localStorage.setItem(t,JSON.stringify(n))}catch(o){console.log("Couldn't store "+t+" with value "+n)}}function o(e,o,r){var i=t(e,[]);i.unshift(o),i.length>r&&i.pop(),n(e,i)}return{get:t,set:n,push:o}}]),angular.module("freelook.info").factory("prerender",["$q","$http","$window","toast",function(e,t,n,o){function r(r){if(r){var i=e.defer(),l=n.CONFIG.PRERENDER.URL+"/"+encodeURIComponent(r);return t.get(l).success(function(e){i.resolve(e)}).error(function(e){o.show("something went wrong"),i.reject(e)}),i.promise}}return{get:r}}]),angular.module("freelook.info").factory("toast",["$mdToast",function(e){function t(t){n.content(t),e.show(n)}var n=e.simple().position("top right");return{show:t}}]),angular.module("freelook.info").controller("header.ctrl",function(){}),angular.module("freelook.info").controller("input.ctrl",["$rootScope","$scope","$mdBottomSheet","DEFAULT_PLACEHOLDER",function(e,t,n,o){t.items=[],t.placeholder=o,t.fli=e.fli,t.find=function(){t.fli.route.input&&e.go("search?input="+t.fli.route.input)},t.clear=function(){e.fli.route.input=""},t.action=function(e){e&&"function"==typeof e&&!t.fli.route.input&&e()}}]).constant("DEFAULT_PLACEHOLDER","Type what you need"),angular.module("freelook.info").directive("fliInput",function(){return{scope:{icon:"@","do":"&"},templateUrl:"components/_index/input/input.html",controller:"input.ctrl"}}),angular.module("fli.look").controller("look.content.ctrl",["$rootScope","$scope","$sce","read",function(e,t,n,o){e.fli.route.url&&o.get(e.fli.route.url).then(function(e){e&&e.data&&(t.html=n.trustAsHtml(e.data.content))})}]),angular.module("fli.look").directive("fliLookContent",function(){return{controller:"look.content.ctrl",templateUrl:"components/look/content/content.html"}}),angular.module("fli.look").directive("fliLookFull",["$rootScope","$sce","prerender","full",function(e,t,n,o){return{templateUrl:"components/look/full/full.html",link:function(t){e.fli.route.url&&n.get(e.fli.route.url).then(function(n){try{e.fli.progress=!0,t.html=o.get(n)}finally{e.fli.progress=!1}})}}}]),angular.module("fli.look").factory("full",["$sce","$window","$location","$rootScope","$cacheFactory",function(e,t,n,o,r){function i(t){var n=c.parseFromString(t,"text/html"),r=$(n),i="";return r.find("link").each(function(e,t){$(t).attr("href",function(e,t){if(t)switch(t.substr(0,2)){case"ht":case"//":return t;case"/":return o.fli.route.url+t;default:return o.fli.route.url+"/"+t}})}),r.find("script, iframe").remove(),i=e.trustAsHtml(n.documentElement.innerHTML),l(i),i}function l(e){a.put(n.url(),e)}function u(e,t){return a.get(n.url())||i(e,t)}var a=r("full"),c=new window.DOMParser;return{get:u}}]),angular.module("fli.look").factory("read",["$http","toast",function(e,t){function n(n){var o="https://readability.com/api/content/v1/parser?url="+n+"&token=b727165def07f9d405d194498ba5e3df21c87535&callback=JSON_CALLBACK";return e.jsonp(o).error(function(){t.show("something went wrong")})}return{get:n}}]),angular.module("fli.look").directive("fliLookShort",["$rootScope","prerender","short",function(e,t,n){return{templateUrl:"components/look/short/short.html",link:function(o){o.shortData=[],e.fli.route.url&&t.get(e.fli.route.url).then(function(t){try{e.fli.progress=!0,o.shortData=n.get(t,e.fli.route)}finally{e.fli.progress=!1}})}}}]),angular.module("fli.look").factory("short",["$sce","$window","$location","$rootScope","$cacheFactory",function(e,t,n,o,r){function i(){w="",k=""}function l(){var e=window.document.createElement("a");return e.href=o.fli.route.url,e.protocol+"//"+e.host}function u(e,n){var r=l();e.find("a").each(function(e,i){$(i).attr("href",function(e,i){if(i)switch(i.substr(0,1)){case"h":break;case"/":i=r+i;break;case"m":return i;default:i=r+"/"+i}return"http://"+t.location.host+"/look?url="+i+"&input="+o.fli.route.input+"&type="+n})})}function a(e,t){var n=null;return w||(w=$("body",e)),"body"===t?w:($("*:contains("+t+")",w).each(function(e,t){var o=$(t);o.children().length||(n||(n=$("<div>")),n.append(o.parent()))}),n)}function c(t,n){var o,r=[];return k=k?k:g.parseFromString(t,"text/html"),o=a(k,n),o&&o.each(function(t,n){var o=$(n);o.find("script, iframe, img").remove(),u(o,"short");var i=o.html();i&&r.push({html:e.trustAsHtml(i)})}),r.length?r:""}function f(e,t){var n=null;return[t.context,t.input].some(function(t){return n=c(e,t),!!n}),d(n),n}function s(e,t){var n=null,o=t.input||"",r=o.split(" ");return r.length>2&&(r.sort(function(e,t){return t.length-e.length}),r.some(function(t){return n=c(e,t),!!n})),d(n),n}function m(e){var t=c(e,"body");return d(t),t}function d(e){h.put(n.url(),e)}function p(e,t){return i(),h.get(n.url())||f(e,t)||s(e,t)||m(e)}var h=r("short"),g=new window.DOMParser,w="",k="";return{get:p,fixLinks:u}}]),angular.module("fli.search").factory("google",["$http","toast",function(e,t){function n(n){if(n){var o="https://www.googleapis.com/customsearch/v1element?key=AIzaSyCVAXiUzRYsML1Pv6RwSG1gunmMikTzQqY&cx=007077922014062052604:wiiu7xrm8yk&q="+n+"&callback=JSON_CALLBACK";return e.jsonp(o).error(function(){t.show("something went wrong")})}}function o(n){if(n){var o="http://suggestqueries.google.com/complete/search?client=chrome&q="+n+"&callback=JSON_CALLBACK";return e.jsonp(o).error(function(){t.show("something went wrong")})}}function r(){var n="http://api.wordnik.com/v4/words.json/randomWord?api_key=a2a73e7b926c924fad7001ca3111acd55af2ffabf50eb4ae5&callback=JSON_CALLBACK";return e.jsonp(n,{cache:!1}).error(function(){t.show("something went wrong")})}return{search:n,autocomplete:o,random:r}}]),angular.module("fli.search").controller("search.result.ctrl",["$scope","$mdMedia","google","yandex",function(e,t,n,o){e.search={},e.suggested=[],e.lucky="freedom",e.href=function(n){return t("gt-sm")?"search?&input="+e.fli.route.input+"&url="+n.url:"look?url="+n.url+"&input="+e.fli.route.input},n.random().success(function(t){e.lucky=t.word}),e.fli.route.input&&(n.search(e.fli.route.input).success(function(t){e.search=t||{}}).error(function(){o.search(e.fli.route.input).then(function(t){e.search=t||{}})}),n.autocomplete(e.fli.route.input).success(function(t){e.suggested=t[1]||[]}))}]),angular.module("fli.search").directive("fliSearchResult",function(){return{controller:"search.result.ctrl",templateUrl:"components/search/result/result.html"}}),angular.module("fli.search").factory("yandex",["prerender",function(e){function t(e){return"https://yandex.com/sitesearch?text="+e+"&searchid=2192226&frame=1"}function n(e){var t={results:[]};return $.each($($.parseHTML(e)).find(".b-serp-item"),function(e,n){t.results.push({title:$(n).find(".b-serp-item__title a span").html(),content:$(n).find(".b-serp-item__text").html(),url:$(n).find(".b-serp-item__title a").attr("href")})}),t}function o(o){return o?e.get(t(o)).then(function(e){return n(e)}):void 0}return{search:o}}]);var CONFIG={API:{URL:"http://localhost:4000"},PRERENDER:{URL:"http://localhost:4001"}};angular.module("freelook.info").constant("CONFIG",CONFIG),function(e){var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(o){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var o=window.document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?o.documentElement.innerHTML=e:o.body.innerHTML=e,o}return n.apply(this,arguments)}}(window.DOMParser),angular.module("freelook.info").run(["$templateCache",function(e){e.put("components/home/home.html",'<header><md-progress-linear md-mode="indeterminate" ng-if="fli.progress"></md-progress-linear><fli-input flex="" icon="bars" do="go(\'/menu\')"></fli-input></header><div id="home" layout="row" flex="" layout-align="center start"><div flex-gt-sm="10"></div><md-content layout="row" layout-sm="column" layout-wrap="" flex=""><md-whiteframe flex-sm="" flex-gt-sm="45" class="md-whiteframe-z1" layout="column" ng-repeat="item in widgets | filter:fli.route.input"><div><span ng-bind="item.name"></span></div><div class="result" ng-if="!!item.items"><a ng-repeat="i in item.items" ng-href="{{item.href(i)}}" ng-bind="i.input"></a></div></md-whiteframe></md-content></div><footer ng-include="\'components/_index/footer/footer.html\'"></footer>'),e.put("components/look/look.html",'<header><md-progress-linear md-mode="indeterminate" ng-if="fli.progress"></md-progress-linear><fli-input flex="" icon="bars" do="go(\'/menu\')"></fli-input></header><md-content layout="column" id="look" flex=""><fli-look-content flex=""></fli-look-content></md-content><footer ng-include="\'components/_index/footer/footer.html\'"></footer>'),e.put("components/menu/menu.html",'<header><md-progress-linear md-mode="indeterminate" ng-if="fli.progress"></md-progress-linear><fli-input flex="" icon="home" do="go(\'/\')"></fli-input></header><div id="menu" layout="row" flex=""><md-content layout="row" flex="" layout-wrap=""><div flex=""><md-whiteframe flex="45" class="md-whiteframe-z1" ng-click="go(item.href)" layout="row" ng-repeat="item in menu | filter: fli.route.input"><i class="fa fa-{{item.icon}}"></i> <span ng-bind="item.name"></span></md-whiteframe></div></md-content></div><footer ng-include="\'components/_index/footer/footer.html\'"></footer>'),e.put("components/search/search.html",'<header><md-progress-linear md-mode="indeterminate" ng-if="fli.progress"></md-progress-linear><fli-input flex="" icon="bars" do="go(\'/menu\')"></fli-input></header><div id="search" flex="" layout="row"><md-content flex="" layout="column"><fli-search-result layout="column"></fli-search-result></md-content><fli-look-content ng-if="!!fli.route.url && fli.media(\'gt-sm\')" flex="60"></fli-look-content></div><footer ng-include="\'components/_index/footer/footer.html\'"></footer>'),e.put("components/_index/footer/footer.html",'<md-whiteframe layout="column" class="md-whiteframe-z1" layout-align="center center" style="margin: 5px;"><p>with ♥ <a ng-href="info" title="{{fli.description}}">freelook.info</a></p></md-whiteframe>'),e.put("components/_index/header/header.html",'<div id="header"></div>'),e.put("components/_index/input/input.html",'<form name="form" ng-submit="find(form)" layout="row"><md-button class="md-fab md-primary" ng-click="action(do)"><i ng-if="!fli.route.input" class="fa fa-{{icon}}"></i> <i ng-if="!!fli.route.input" class="fa fa-search"></i></md-button><md-autocomplete flex="" id="input" md-search-text="fli.route.input" md-selected-item="selectedItem" md-items="item in items" md-item-text="item.display" placeholder="{{placeholder}}"></md-autocomplete></form>'),e.put("components/look/content/content.html",'<md-whiteframe ng-if="!!html" class="md-whiteframe-z1" flex="" layout="column"><div ng-bind-html="html"></div></md-whiteframe>'),e.put("components/look/full/full.html",'<md-whiteframe flex="" class="md-whiteframe-z1" layout="column"><div ng-bind-html="html"></div></md-whiteframe>'),e.put("components/look/short/short.html",'<md-whiteframe flex="" class="md-whiteframe-z1" layout="column" ng-repeat="short in shortData"><div ng-bind-html="short.html"></div></md-whiteframe>'),e.put("components/search/result/result.html",'<md-whiteframe class="md-whiteframe-z1" layout="column" ng-repeat="result in search.results"><div><a ng-href="{{href(result)}}" ng-bind-html="result.title"></a></div><div ng-bind-html="result.content"></div></md-whiteframe><md-whiteframe class="md-whiteframe-z1" layout="column" layout-align="center center" ng-if="!search.results && !fli.route.input"><p><a class="lucky" ng-href="{{\'search?input=\' + lucky}}">get lucky</a></p></md-whiteframe><md-whiteframe class="md-whiteframe-z1" layout="column" ng-if="!!suggested.length"><div class="title" ng-if="!!suggested.length">Suggested requests:</div><div class="result"><a ng-repeat="suggest in suggested" ng-href="{{\'search?input=\' + suggest}}" ng-bind="suggest"></a></div></md-whiteframe>'),e.put("components/_index/core/timeline/timeline.html",'<timeline><timeline-node side="left"><timeline-badge class="info"><i class="glyphicon glyphicon-check"></i></timeline-badge><timeline-panel><timeline-heading><timeline-title>Some twitter post</timeline-title><p><small class="text-muted"><i class="glyphicon glyphicon-time"></i> 11 hours ago via Twitter</small></p></timeline-heading><timeline-content><p>Twitter post goes here</p></timeline-content></timeline-panel></timeline-node><timeline-node side="right"><timeline-badge class="warning"><i class="glyphicon glyphicon-credit-card"></i></timeline-badge><timeline-panel><timeline-heading><timeline-title>Another twitter post</timeline-title><p><small class="text-muted">12 hours ago via Twitter</small></p></timeline-heading><timeline-content><p>Another twitter post goes here</p></timeline-content></timeline-panel></timeline-node></timeline>')}]);